<!-- TODO: Does this cause flashing? Can we do something about that? -->
<div ng-include src="'/partials/header.html'"></div>

<div class="view">
<div class="hello span12">

	<div class="whatContainer">
		<div class="helloContainer projectContainer span11 row" ng-show="getCommunity()">
			<div class="span6" style="margin: 0; box-sizing: border-box;
				padding-left: 1.4em; padding-right: 1.4em">
				<h3>{{getCommunity().name}}</h3>
				<div ng-bind-html="getCommunity().description"></div>
			</div>

			<div class="span5" style="margin: 0; margin-top: 1.2em">
				<img ng-src="{{getCommunityImageUrl(getCommunity())}}" 
					class="img-polaroid" 
					style="background-color: #ccc"/>
				<div class="photoCredit">photo credit: yes</div>
			</div>
		</div>

		<div class="helloContainer whoContainer span11 row" ng-hide="getCommunity()">
			<div class="span8 column first pitch">
				<div class="span3 first column">
					<div class="whoImageContainer">
						<img id="whoImage" ng-src="{{profile.getImageUrl()}}"/>
						<div style="text-align: center">
							<div id="whoName">{{profile.getName()}}</div>
						</div>
					</div>
				</div>

				<div class="span5 column">
					<h3>Hello</h3>
					<div id="whoPresent" ng-bind-html="profile.getPresent()">
					</div>
				</div>
			</div>
			<div class="projects span3 column">
				<h3>Communities</h3>
				<ul>
					<li ng-repeat="community in profile.getCommunities()">
						<a href="{{profile.getCommunityUrl(community)}}">{{community.name}}</a>
					</li>
				</ul>

				<!-- TODO: Have a list of past projects in here, somehow. -->
			</div>
		</div>
	</div>

	<div class="helloContainer span11 row clear: left" style="margin-top: 0;">
		<div>
			<div>
				<ul class="communityNav">
					<!-- TODO: Use ng-click to not hit the server -->
					<li>
						<a href="{{profile.getBackgroundUrl()}}"><img src="/img/arrow-left.png" class="backgroundArrow"/></a>
						<a href="{{profile.getBackgroundUrl()}}">background</a>
					</li>
					<li>
						<a href="{{profile.getHelloUrl()}}">
						<img ng-src="{{profile.getImageUrl()}}" width="66"></a>
					</li>
					<li ng-repeat="community in profile.getCommunities()">
						<div ng-class="{ softHighlight: isEqual(community, getCommunity()) }" 
						class="iconContainer">
							<a ng-click="showCommunity(community)">
								<img ng-src="{{getCommunityIconUrl(community)}}" width="50"/>
							</a>
						</div>
					</li>
					<li>
						<a href="{{profile.getBackgroundUrl()}}">future plans</a>
						<a href="{{profile.getBackgroundUrl()}}"><img src="/img/arrow-right.png" class="backgroundArrow"/></a>
					</li>
				</ul>
			</div>
		</div>
	</div>	

	<!-- -->
	<div class="process span12">
		<div class="row">
			<h3 class="contributeTitle span4">Contribute</h3>
			<h3 class="contributeTitle span3" 
			ng-class="{ hide: !canHazContribution() }">How often?</h3>
			<!-- hearts -->
			<h3 class="contributeHearts span3">
				<span ng-repeat="thing in contributions">
					<span class="heart" ng-show="thing.canHaz && !thing.recurring">♥</span>
					<span class="recurringHeart" 
						ng-show="thing.canHaz && thing.recurring">♥</span>
				</span>&nbsp;
			</h3>
		</div>

		<div class="things span4">
			<div style="clear: left">
				<label ng-repeat="thing in contributions" class="checkbox choice-group"
					ng-class="{ canHaz: thing.canHaz }">
					<input type="checkbox" ng-model="thing.canHaz" id="{{thing.id}}"/>
					<span>A {{thing.unit}} of {{thing.name}}</span>
					<div class="glyph"><i class="icon-{{thing.glyph}}"></i></div>
					<span class="price">${{thing.price}}</span>
				</label>
			</div>
		</div>

		<div class="frequency span3">
			<div>
				<div class="freqThing" ng-repeat="thing in contributions">
					<div class="row freq-group" ng-class="{ peerSelected: thing.canHaz}" >
						<div class="freq-choice once" ng-click="setFrequency(thing, 'once')"
							ng-class="{ 
								selected: 
									thing.canHaz &&
									!thing.recurring
							}">
							<div class="heart-group">
								<div class="heart">♥</div>
							</div>
							<label>once</label>
						</div>
						<div class="freq-choice monthly" ng-click="setFrequency(thing, 'month')"
							ng-class="{ 
								selected: 
									thing.canHaz &&
									thing.recurring && 
									isEqual(thing.frequency, 'month') 
							}">
							<div class="heart-group">
								<div class="copper heart">♥</div>
							</div>
							<label>monthly</label>
						</div>
						<div class="freq-choice" ng-click="setFrequency(thing, 'week')"
						ng-class="{ 
							selected: 
								thing.canHaz &&
								thing.recurring && 
								isEqual(thing.frequency, 'week') 
							}">
							<div class="heart-group">
								<div class="copper heart heart-row">♥</div>
								<div class="copper heart heart-row">♥</div>
								<div class="copper heart heart-row">♥</div>
								<div class="copper heart heart-row">♥</div>
							</div>
							<label>weekly</label>
						</div>
						<div class="freq-choice" ng-click="setFrequency(thing, 'day')"
						ng-class="{ 
							selected: 
								thing.canHaz &&
								thing.recurring && 
								isEqual(thing.frequency, 'day') 
							}">
							<div class="heart-group">
								<div class="copper heart heart-row">♥♥♥♥♥</div>
								<div class="copper heart heart-row">♥♥♥♥♥</div>
								<div class="copper heart heart-row">♥♥♥♥♥</div>
								<div class="copper heart heart-row">♥♥♥♥♥</div>
							</div>
							<label>daily</label>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="total span3">
			<div class="totalContainer">
				<div ng-class="{ hide: !canHazContribution() }">
					<p>You've selected things that come to <strong>{{priceNow() | currency}}</strong> now, and
					{{pricePerMonth() | currency}} each month after that.</p>
					<div id="contributeButton">
						<button class="btn btn-inverse" ng-click="toContribute()">Contribute</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="support span12">
		<div class="row">
			<h3 class="contributeTitle span7">Supported by the following monthly contributions</h3>
		</div>
		<div class="supportRow" ng-repeat="thing in profile.getSupport()">
			<span class="supportText">A {{thing.unit}} of {{thing.name}}.</span>
			<span class="copper heart">♥</span> {{thing.count | number:0 }}</span>
		</div>
	</div>

	<div class="backers span12">
		<div class="row"><h3 class="contributeTitle span7">Backed by the following people</h3></div>
		<div class="backersContent">
			<span ng-repeat="backer in profile.getBackers()">
				{{backer}}
				<span ng-show="$middle">,</span>
			</span>
		</div>
	</div>
</div>
</div>
